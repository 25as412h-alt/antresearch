# アリ類群集・植生データ管理システム v1.0

## 概要

同所的アリ類群集および立地環境(植生)の調査データを効率的に管理・解析するためのデスクトップアプリケーションです。

## 主な機能

### 1. データ管理（Phase 1-2）
- ✅ 親調査地の登録・編集・削除
- ✅ 調査地の登録・編集・削除
- ✅ 調査イベントの管理
- ✅ 植生データの入力
- ✅ アリ類出現記録の管理
- ✅ 種名マスタ管理
- ✅ 論理削除・復元機能

### 2. データ閲覧・検索（Phase 3）
- ✅ 複数の表示モード（調査イベント/調査地/親調査地/種別記録）
- ✅ キーワード検索
- ✅ 削除済みデータの表示切替
- ✅ 詳細情報パネル
- ✅ 統計サマリー表示
- ✅ 種ごとの統計情報（出現頻度、平均個体数等）

### 3. データ出力・解析（Phase 4）
- ✅ アリ類群集行列出力（CSV）
  - 集計単位選択（調査イベント/調査地/親調査地）
  - 集約方法（合算/平均/最大値）
  - 値の種類（個体数/在不在/相対頻度）
- ✅ 植生行列出力（CSV）
- ✅ 生態学指標の算出
  - Shannon多様度指数
  - Simpson多様度指数
  - 種の均等度
  - 種数・総個体数
- ✅ 散布図作成
  - 回帰線表示（線形/多項式）
  - 決定係数(R²)表示
- ✅ 統計検定
  - 相関検定（Pearson/Spearman）

### 4. 地理情報可視化（Phase 5）
- ✅ 地図表示（folium使用）
  - OpenStreetMap
  - マーカー表示
  - ポップアップ情報
  - ヒートマップ
- ✅ 距離行列算出（Haversine公式）
- ✅ クラスタ解析
  - K-Means法
  - 階層的クラスタリング
  - DBSCAN
  - クラスタ別地図表示

### 5. データ管理・保守（Phase 6）
- ✅ CSVインポート
  - 親調査地
  - 調査地
  - 種名マスタ
  - テンプレートダウンロード
  - エラー詳細表示
- ✅ バックアップ・復元
  - 手動バックアップ作成
  - 自動バックアップ（起動時）
  - バックアップ一覧表示
  - 復元機能
- ✅ データ整合性チェック
  - SQLite整合性検証
  - 孤立レコード検出
  - 重複データ検出
- ✅ アプリケーション設定
  - フォントサイズ変更
  - テーマ選択
  - バックアップ設定

## セットアップ

### 必須環境
- Python 3.9以上
- Windows 10/11 (64bit)

### インストール手順

1. **リポジトリのクローン**
```bash
git clone <repository-url>
cd ant_research_system
```

2. **ディレクトリ構造の作成**
```bash
mkdir models views controllers utils resources logs backups data
mkdir resources\styles
```

3. **必要なファイルの配置**
すべてのアーティファクトファイルを対応するディレクトリに配置してください。

4. **依存パッケージのインストール**
```bash
pip install -r requirements.txt
```

5. **アプリケーションの起動**
```bash
python main.py
```

## ファイル構成

```
ant_research_system/
├── main.py                      # エントリーポイント
├── config.ini                   # 設定ファイル
├── requirements.txt             # 依存パッケージ
├── models/                      # データモデル
│   ├── __init__.py
│   ├── database.py             # データベース管理
│   ├── parent_site.py          # 親調査地モデル
│   ├── survey_site.py          # 調査地モデル
│   ├── survey_event.py         # 調査イベントモデル
│   ├── species.py              # 種名マスタモデル
│   ├── ant_record.py           # アリ類記録モデル
│   └── vegetation.py           # 植生データモデル
├── views/                       # ビュー（GUI）
│   ├── __init__.py
│   ├── main_window.py          # メインウィンドウ
│   ├── data_input_tab.py       # データ入力タブ
│   ├── data_view_tab.py        # データ閲覧タブ
│   ├── analysis_tab.py         # 解析・出力タブ
│   ├── map_cluster_tab.py      # 地図・クラスタタブ
│   └── settings_tab.py         # 設定・管理タブ
├── controllers/                 # コントローラー
│   ├── __init__.py
│   └── analysis_engine.py      # 解析エンジン
├── utils/                       # ユーティリティ
│   ├── __init__.py
│   ├── sample_data.py          # サンプルデータ生成
│   └── csv_import.py           # CSVインポート
├── resources/                   # リソース
│   └── styles/
│       └── default.qss         # スタイルシート
├── logs/                        # ログファイル
├── backups/                     # バックアップ
└── data/                        # データベース
    └── ant_database.db
```

## 初回起動

初回起動時にサンプルデータ生成のダイアログが表示されます。「はい」を選択すると、以下のサンプルデータが生成されます：

- 親調査地: 3件
- 調査地: 5件
- 種: 13種
- 調査イベント: 6件
- 植生データ: 6件
- アリ類記録: 19件

## 使用方法

### データ入力

1. **親調査地タブ**で親調査地を登録
2. **調査地タブ**で調査地を登録（親調査地を選択）
3. **調査イベントタブ**で調査イベントを登録
4. **植生データタブ**で植生情報を入力
5. **アリ類データタブ**で出現記録を登録

### データ閲覧

- 表示モードを選択（調査イベント/調査地/親調査地/種別記録）
- キーワード検索でフィルタリング
- 行を選択すると詳細情報が表示されます

### データ出力

1. **データ出力タブ**で出力形式を選択
2. パラメータを設定
3. 「CSV出力」または「プレビュー」をクリック

### 地図表示

1. **地図・クラスタタブ**を開く
2. 表示対象と色分けを選択
3. 「地図を生成」をクリック
4. ブラウザで地図が開きます

### バックアップ

- 自動バックアップ: 起動時に自動実行
- 手動バックアップ: 「設定・管理」→「バックアップ」タブ

## ショートカットキー

- **F5**: 表示更新
- **Ctrl+Q**: アプリケーション終了
- **F1**: ヘルプ表示（未実装）

## データベース

- **形式**: SQLite3
- **場所**: `data/ant_database.db`
- **バックアップ**: `backups/ant_database_YYYYMMDD_HHMMSS.db`

## ログ

- **場所**: `logs/app_YYYYMMDD.log`
- **ローテーション**: 日次
- **保持期間**: 30日

## トラブルシューティング

### アプリケーションが起動しない
1. Python 3.9以上がインストールされているか確認
2. `pip install -r requirements.txt` を実行
3. `logs/` ディレクトリのログファイルを確認

### 地図が表示されない
1. インターネット接続を確認
2. foliumライブラリがインストールされているか確認
3. ブラウザのポップアップブロックを解除

### データベースエラー
1. `data/` ディレクトリに書き込み権限があるか確認
2. データベース整合性チェックを実行
3. バックアップから復元

## 開発情報

- **言語**: Python 3.9+
- **GUI**: PySide6
- **データベース**: SQLite3
- **地図**: folium
- **解析**: pandas, numpy, scipy, scikit-learn
- **グラフ**: matplotlib

## ライセンス

© 2025 研究者本人

## バージョン履歴

### v1.0.0 (2025-12-20)
- 初回リリース
- 全6フェーズの機能実装完了

## サポート

問題が発生した場合は、`logs/` ディレクトリのログファイルを確認してください。